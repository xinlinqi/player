;(function($){var $songProgressBar=$('#songProgressBar'),$songProgressCurrent=$('#songProgressCurrent'),$songProgressHideBar=$('#songProgressHideBar'),$volumeProgressCurrent=$('#volumeProgressCurrent'),$volumeCurrentBtn=$('#volumeCurrentBtn'),$volumeProgressBar=$('#volumeProgressBar'),$volumePanel=$('#volumePanel'),$volumeBtn=$('#volumeBtn'),$playBtn=$('#playBtn'),$pauseBtn=$('#pauseBtn'),$lrc=$('#lrc'),host='http://xiaoqian.b0.upaiyun.com/',fileName='s1',soundId='mySound',songTime=0,player={};player.init=function(){this.create();this.bind()};player.create=function(){soundManager.setup({url:'swf/',debugMode:false,onready:function(){soundManager.createSound({id:soundId,url:host+fileName+'.mp3',volume:50,autoLoad:true,onload:function(){songTime=Math.floor((this.bytesTotal/this.bytesLoaded)*this.duration)},whileplaying:function(){var currentProgressPos=(this.position/this.duration)*90,pos=(this.position/1000).toFixed();if(currentProgressPos>=90){return}$songProgressCurrent.css('width',currentProgressPos+'%');if(player.lrc.options.data[pos]){if(pos!=player.lrc.options.index){player.lrc.options.index=pos;$lrc.animate({'top':'-=24px'},'slow').find('p').removeClass('high').end().find('p[time='+pos+']').addClass('high')}}},onfinish:function(){showBtn($pauseBtn,$playBtn);$songProgressCurrent.animate({'width':0},'slow');$lrc.animate({'top':0},'slow');soundManager.setPosition(soundId,0)}});player.lrc.getData()}})};player.bind=function(){$playBtn.click(function(){showBtn($(this),$pauseBtn);soundManager.play(soundId)});$pauseBtn.click(function(){showBtn($(this),$playBtn);soundManager.pause(soundId)});$volumeBtn.click(function(){($volumePanel.is(':hidden'))?$volumePanel.show():$volumePanel.hide()});$songProgressHideBar.click(function(event){soundManager.pause(soundId);showBtn($playBtn,$pauseBtn);var pos=player.volume.getAbsPos(this),page=player.volume.getPageXY(event),currentProgressPos=((page.x-pos.x)/$(this).width())*90,secondWidth=songTime/$(this).width(),currentPlayTime=(page.x-pos.x)*secondWidth;$songProgressCurrent.animate({'width':currentProgressPos+'%'},'slow',function(){soundManager.setPosition(soundId,currentPlayTime);soundManager.resume(soundId);soundManager.play(soundId)});player.lrc.scroll(currentPlayTime)});$volumeCurrentBtn.mousedown(player.volume.down);$(document).mousemove(player.volume.move);$(document).mouseup(player.volume.up)};player.lrc={options:{index:-1,data:{},html:[]},scroll:function(time){var jumpTime=0;for(var item in player.lrc.options.data){if(item<=time/1000){jumpTime=item}}if(jumpTime){var $jump=$lrc.find('p[time='+jumpTime+']'),currentTop=$jump.offset().top-$lrc.offset().top-parseInt($lrc.css('padding-top'));$jump.addClass('high').siblings().removeClass('high');$lrc.animate({'top':-currentTop},'slow')}else{$lrc.find('p').removeClass('high');$lrc.animate({'top':0},'slow')}},getData:function(){$.get(fileName+'.lrc',function(data){var arr=data.split("\n");for(var i=0,len=arr.length;i<len;i++){var text=arr[i].replace(/\[\d*:\d*((\.|\:)\d*)*\]/g,''),timeArr=arr[i].match(/\[\d*:\d*((\.|\:)\d*)*\]/g);if(timeArr){for(var j=0,lenn=timeArr.length;j<lenn;j++){var min=Math.floor(timeArr[j].match(/\[\d*/i).toString().slice(1)),sec=Math.floor(timeArr[j].match(/\:\d*/i).toString().slice(1)),time=min*60+sec;player.lrc.options.data[time]=$.trim(text)}}}player.lrc.createUI(player.lrc.options.data)})},createUI:function(data){var i=0;for(var item in data){player.lrc.options.html[i]='<p time='+item+'>'+data[item]+'</p>';i++}$lrc.html(player.lrc.options.html.join(' '))}};player.volume={options:{$dragging:null,diffXY:null,dragXY:null,pageXY:null,offsetXY:null,scrollXY:null,containerXY:null,volHeight:0,timer:null},down:function(event){player.volume.options.diffXY=player.volume.getDiffXY(this,event);player.volume.options.containerXY=player.volume.getAbsPos($volumeProgressBar[0]);player.volume.options.volHeight=$volumeProgressBar.height();player.volume.options.$dragging=$(this)},move:function(event){if(player.volume.options.$dragging!==null){player.volume.options.pageXY=player.volume.getPageXY(event);player.volume.options.dragXY=player.volume.getDragXY(event);var offsetY=player.volume.options.dragXY.y-player.volume.options.containerXY.y;if(offsetY>player.volume.options.volHeight||offsetY<0){return}player.volume.options.$dragging.css('top',offsetY);$volumeProgressCurrent.css('top',offsetY);soundManager.setVolume(soundId,100-(offsetY/player.volume.options.volHeight*100))}},up:function(){if(player.volume.options.$dragging!=null){player.volume.options.$dragging=null;$(document).unbind('mousemove');if(player.volume.options.timer)clearTimeout(player.volume.options.timer);player.volume.options.timer=setTimeout(function(){$(document).mousemove(player.volume.move)},100)}},getEvent:function(event){return event?event:window.event},getScrollXY:function(){return{'x':(document.body.scrollLeft||document.documentElement.scrollLeft),'y':(document.body.scrollTop||document.documentElement.scrollTop)}},getPageXY:function(event){var event=player.volume.getEvent(event),pageX=event.pageX,pageY=event.pageY,scrollXY=player.volume.getScrollXY();if(pageX===undefined){pageX=event.clientX+scrollXY.x;pageY=event.clientY+scrollXY.y}return{'x':pageX,'y':pageY}},getDiffXY:function(obj,event){player.volume.options.pageXY=player.volume.getPageXY(event);player.volume.options.offsetXY=player.volume.getAbsPos(obj);return{'x':player.volume.options.pageXY.x-player.volume.options.offsetXY.x,'y':player.volume.options.pageXY.y-player.volume.options.offsetXY.y}},getDragXY:function(event){return{'x':player.volume.options.pageXY.x-player.volume.options.diffXY.x,'y':player.volume.options.pageXY.y-player.volume.options.diffXY.y}},getAbsPos:function(obj){var offsetX=obj.offsetLeft,offsetY=obj.offsetTop,current=obj.offsetParent;while(current!==null){offsetX+=current.offsetLeft;offsetY+=current.offsetTop;current=current.offsetParent}return{'x':offsetX,'y':offsetY}}};function showBtn(a,b){a.hide();b.show()}player.init()})(jQuery);